---
import BaseLayout from "@layouts/base-layout.astro";
import getAllArt, { type Artwork } from "@api/art";

const arts = await Astro.glob<Artwork>("../assets/showcase/*.png").then((data) =>
  getAllArt(data),
);

const totalArtworks = arts.length;
const categorySet = new Set<string>();
arts.forEach((a) => a.tags.forEach((t) => categorySet.add(t)));
const totalCategories = categorySet.size;

// Site birthday
const birthday = new Date("2024-06-01");
const now = new Date();
const daysAlive = Math.floor((now.getTime() - birthday.getTime()) / 86400000);
---

<BaseLayout>
  <section class="secret-page">
    <div class="secret-header">
      <p class="secret-found">you found it.</p>
      <h1 class="secret-title">
        the <span class="text-accent">secret</span> page
      </h1>
      <p class="secret-sub">congrats — you're either curious or lost. either way, welcome.</p>
    </div>

    <!-- Dev Stats -->
    <div class="secret-section">
      <h2 class="section-label">// dev stats</h2>
      <div class="stats-grid">
        <div class="stat-card">
          <span class="stat-value" data-count={totalArtworks}>0</span>
          <span class="stat-name">artworks</span>
        </div>
        <div class="stat-card">
          <span class="stat-value" data-count={totalCategories}>0</span>
          <span class="stat-name">categories</span>
        </div>
        <div class="stat-card">
          <span class="stat-value" data-count={daysAlive}>0</span>
          <span class="stat-name">days alive</span>
        </div>
        <div class="stat-card">
          <span class="stat-value" data-count={3}>0</span>
          <span class="stat-name">themes</span>
        </div>
      </div>
    </div>

    <!-- Tech Stack -->
    <div class="secret-section">
      <h2 class="section-label">// built with</h2>
      <div class="tech-pills">
        <span class="tech-pill">Astro</span>
        <span class="tech-pill">Svelte</span>
        <span class="tech-pill">Tailwind CSS</span>
        <span class="tech-pill">Swiper</span>
        <span class="tech-pill">TypeScript</span>
        <span class="tech-pill">Zod</span>
        <span class="tech-pill">too much redbull</span>
      </div>
    </div>

    <!-- Credits -->
    <div class="secret-section">
      <h2 class="section-label">// credits</h2>
      <div class="credit-card">
        <strong>Ashfid</strong>
        <p>built by the kindest person on this planet, this wouldn't be here if it weren't for him.</p>
        <a href="https://ashfid.dev/" target="_blank" rel="noopener noreferrer" class="credit-link">ashfid.dev &nearr;</a>
      </div>
    </div>

    <!-- Easter Eggs -->
    <div class="secret-section">
      <h2 class="section-label">// hidden things on this site</h2>
      <ul class="egg-list">
        <li class="egg-item">
          <span class="egg-icon">&#x1F36A;</span>
          <div>
            <strong>Footer click counter</strong>
            <p>click the footer message enough times and you'll get a cookie</p>
          </div>
        </li>
        <li class="egg-item">
          <span class="egg-icon">&#x1F3B2;</span>
          <div>
            <strong>Gallery shuffle</strong>
            <p>the dice button randomizes your gallery — click again to unshuffle</p>
          </div>
        </li>
        <li class="egg-item">
          <span class="egg-icon">&#x1F520;</span>
          <div>
            <strong>Name scramble</strong>
            <p>hover the "Kostur." logo — it glitches out and reassembles</p>
          </div>
        </li>
        <li class="egg-item">
          <span class="egg-icon">&#x1F4AC;</span>
          <div>
            <strong>Random footer messages</strong>
            <p>7 different messages — refresh to see a new one</p>
          </div>
        </li>
        <li class="egg-item">
          <span class="egg-icon">&#x2728;</span>
          <div>
            <strong>Animated favicon</strong>
            <p>look at the tab — the icon glows with the accent color</p>
          </div>
        </li>
        <li class="egg-item">
          <span class="egg-icon">&#x1F3A8;</span>
          <div>
            <strong>This page</strong>
            <p>you're on it right now. not linked anywhere. nice find.</p>
          </div>
        </li>
      </ul>
    </div>

    <!-- Sign-off -->
    <div class="secret-section signoff">
      <p>made with love, late nights, and way too many ctrl+z's</p>
      <a href="/" class="back-link">back to the gallery &rarr;</a>
    </div>
  </section>
</BaseLayout>

<style>
  .secret-page {
    max-width: 640px;
    margin: 0 auto;
    padding: 4rem 1.5rem 6rem;
    display: flex;
    flex-direction: column;
    gap: 3rem;
  }

  .secret-header {
    text-align: center;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .secret-found {
    font-size: 0.8rem;
    color: var(--accent-color);
    letter-spacing: 0.2em;
    text-transform: uppercase;
    opacity: 0;
    animation: fade-up 0.6s ease forwards;
  }

  .secret-title {
    font-family: var(--font-accent);
    font-size: clamp(2rem, 6vw, 3rem);
    line-height: 1.1;
    opacity: 0;
    animation: fade-up 0.6s ease 0.15s forwards;
  }

  .secret-sub {
    font-size: 0.9rem;
    opacity: 0;
    color: rgba(255, 255, 255, 0.4);
    animation: fade-up 0.6s ease 0.3s forwards;
  }

  @keyframes fade-up {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .secret-section {
    opacity: 0;
    animation: fade-up 0.6s ease forwards;
  }
  .secret-section:nth-child(2) { animation-delay: 0.4s; }
  .secret-section:nth-child(3) { animation-delay: 0.55s; }
  .secret-section:nth-child(4) { animation-delay: 0.7s; }
  .secret-section:nth-child(5) { animation-delay: 0.85s; }
  .secret-section:nth-child(6) { animation-delay: 1.0s; }

  .section-label {
    font-family: monospace;
    font-size: 0.75rem;
    color: var(--accent-color);
    opacity: 0.6;
    margin-bottom: 1rem;
    letter-spacing: 0.05em;
  }

  /* Stats grid */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem;
  }

  .stat-card {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 12px;
    padding: 1.25rem;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    transition: border-color 0.2s ease;
  }

  .stat-card:hover {
    border-color: var(--accent-color);
  }

  .stat-value {
    font-family: var(--font-accent);
    font-size: 2rem;
    color: var(--accent-color);
    line-height: 1;
  }

  .stat-name {
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.4);
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

  /* Tech pills */
  .tech-pills {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .tech-pill {
    padding: 0.3rem 0.8rem;
    border-radius: 9999px;
    border: 1px solid rgba(255, 255, 255, 0.12);
    font-size: 0.8rem;
    color: var(--text-color);
    opacity: 0.7;
    transition: all 0.2s ease;
  }

  .tech-pill:hover {
    border-color: var(--accent-color);
    color: var(--accent-color);
    opacity: 1;
  }

  /* Easter egg list */
  .egg-list {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .egg-item {
    display: flex;
    gap: 0.75rem;
    align-items: flex-start;
    padding: 0.75rem;
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.05);
    transition: border-color 0.2s ease;
  }

  .egg-item:hover {
    border-color: var(--accent-color);
  }

  .egg-icon {
    font-size: 1.4rem;
    flex-shrink: 0;
    margin-top: 0.1rem;
  }

  .egg-item strong {
    font-family: var(--font-accent);
    color: var(--accent-color);
    font-size: 0.9rem;
    letter-spacing: 0.03em;
  }

  .egg-item p {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.4);
    margin-top: 0.15rem;
    line-height: 1.4;
  }

  /* Credit card */
  .credit-card {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 12px;
    padding: 1.25rem;
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
    transition: border-color 0.2s ease;
  }

  .credit-card:hover {
    border-color: var(--accent-color);
  }

  .credit-card strong {
    font-family: var(--font-accent);
    font-size: 1.1rem;
    color: var(--accent-color);
    letter-spacing: 0.05em;
  }

  .credit-card p {
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.5);
    line-height: 1.5;
  }

  .credit-link {
    color: var(--accent-color);
    font-size: 0.8rem;
    text-decoration: none;
    letter-spacing: 0.03em;
    opacity: 0.7;
    transition: opacity 0.2s ease;
    width: fit-content;
  }

  .credit-link:hover {
    opacity: 1;
  }

  /* Sign-off */
  .signoff {
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
    padding-top: 1rem;
    border-top: 1px solid rgba(255, 255, 255, 0.06);
  }

  .signoff p {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.25);
    font-style: italic;
  }

  .back-link {
    color: var(--accent-color);
    font-family: var(--font-accent);
    font-size: 0.85rem;
    text-decoration: none;
    letter-spacing: 0.05em;
    transition: opacity 0.2s ease;
  }

  .back-link:hover {
    opacity: 0.7;
  }
</style>

<script>
document.addEventListener("astro:page-load", () => {
  const statEls = document.querySelectorAll<HTMLElement>(".stat-value[data-count]");
  if (!statEls.length) return;

  statEls.forEach((el) => {
    const target = parseInt(el.dataset.count ?? "0", 10);
    const duration = 1200;
    const start = performance.now();

    function tick(now: number) {
      const progress = Math.min((now - start) / duration, 1);
      const eased = 1 - Math.pow(1 - progress, 3);
      el.textContent = String(Math.round(eased * target));
      if (progress < 1) requestAnimationFrame(tick);
    }

    const observer = new IntersectionObserver(
      (entries) => {
        if (entries[0].isIntersecting) {
          observer.disconnect();
          requestAnimationFrame(tick);
        }
      },
      { threshold: 0.5 },
    );
    observer.observe(el);
  });
});
</script>
